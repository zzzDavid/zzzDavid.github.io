
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Niansong Zhang">
    <title>On HeteroCL - Niansong Zhang</title>
    <meta name="author" content="Niansong Zhang">
    
        <meta name="keywords" content="Niansong Zhang,Niansong,">
    
    
        <link rel="icon" href="https://res.cloudinary.com/dxzx2bxch/image/upload/v1604473094/github/palm-tree_yvmmw8.svg">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Niansong Zhang","sameAs":["https://github.com/zzzDavid","https://twitter.com/WW5bbaRC2F46nt6","https://www.linkedin.com/in/niansong-zhang-b7855a191","mailto:nz264@cornell.edu"],"image":"https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png"},"articleBody":"\nWelcome to my notes on HeteroCL. \nHow do we install HeteroCL?To install HeteroCL, simple clone it from GitHub.1$ git clone --recursive https://github.com/cornell-zhang/heterocl.git\nAfter that, go to the downloaded directory and make it.1$ make -j8\nOptions\nYou can set your own CMake or LLVM version by setting the PATH in Makefile.config.\nYou can turn off the VHLS C simulation feature by setting USE_VIVADO_HLS to 0 in Makefile.config.\n\nComponents of HeteroCLHeteroCL framework overview\nHeteroCL is High-Level-Synthesis with style. How is that so? Previous HLS tools, for example, Vivado HLS, need us users to specify hardware customizations while describing the function, so that it could generate correct circuits from that description. HeteroCL does exactly the same job, but it decouples the hardware customization from algorithm specification, allowing a cleaner programming process. \nRelation with TVMHeteroCL is like an extension from TVM in the sense of compiler. TVM focuses on Tensor computations for CPU and GPU backends. Though TVM supports FPGA backend by using VTA, its tensor operations are pre-defined. On the other hand, HeteroCL offers additional features for FPGA programming that are more flexible and general. Such features include:\n\nDecoupled Algorithm/Hardware specification\nImperative programming for general applications\nVarious hardware customization primitives\nBit-accurate data types\n\nWorkflow of HeteroCLBasic steps to use HeteroCL include:\n\nImport HeteroCL import heterocl as hcl\nInitialize Environment hcl.init()\nDefine Algorithm\nDefine Inputs/Outputs hcl.placeholder()\nApply Hardware Customization s= hcl.create_schedule  \nView lower IR hcl.lower(s)\nCreate Executable f = hcl.build()\nRun Executable f()\n\nFor FPGA backend HeteroCL generates HLS code. For CPU backend it generates a executable.\nTutorialsQuick Link\nUsing Vivado HLS Backend for csynth/csimA simple HLS backend example:\n1234567891011121314151617181920212223242526272829303132333435import heterocl as hclimport numpy as npdef gemm(m=16, n=16, k=16, dtype=hcl.Int(), target=None):    matrix_1 = hcl.placeholder((m, k), dtype=dtype)    matrix_2 = hcl.placeholder((k, n), dtype=dtype)    def kernel(matrix_1, matrix_2):        r = hcl.reduce_axis(0, k, 'k')        return hcl.compute((m, n),                lambda x, y: hcl.sum(matrix_1[x, r] * matrix_2[r, y],                                     axis=r, dtype=dtype),                dtype=dtype,                name=\"out_matrix\")    s = hcl.create_schedule([matrix_1, matrix_2], kernel)    s.to([matrix_1, matrix_2], target.xcel)    s.to(kernel.out_matrix, target.host)    f = hcl.build(s, target=target)    return ftarget = hcl.platform.zc706target.config(compile=\"vivado_hls\", mode=\"csim|csyn\")m = k = n = 16dtype = hcl.Int()hcl_m1 = hcl.asarray(np.random.randint(10, size=(m, k)), dtype=hcl.Int())hcl_m2 = hcl.asarray(np.random.randint(10, size=(m, k)), dtype=hcl.Int())hcl_m3 = hcl.asarray(np.zeros((m, n)), dtype=dtype)fg = gemm(m, n, k, dtype=hcl.Int(), target=target)fg(hcl_m1, hcl_m2, hcl_m3)report = fg.report(target)\nWith above installation steps and Vivado Design Suite 2018.3 installed, I could not get HLS backend working.See the below error message:\n123456789101112131415161718[15:27:16] Generating harness files ...[15:27:16] Compiling the program ...Traceback (most recent call last):  File \"hls_backend_example.py\", line 36, in &lt;module&gt;    fg(hcl_m1, hcl_m2, hcl_m3)  File \"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/function.py\", line 128, in __call__    return f(*args)  File \"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/_ctypes/function.py\", line 183, in __call__    ctypes.byref(ret_val), ctypes.byref(ret_tcode)))  File \"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/base.py\", line 66, in check_call    raise TVMError(py_str(_LIB.TVMGetLastError()))heterocl.tvm._ffi.base.TVMError: TVMCall CFunc Error:Traceback (most recent call last):  File \"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/_ctypes/function.py\", line 54, in cfun    rv = local_pyfunc(*pyargs)  File \"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/runtime.py\", line 153, in copy_and_compile    with open(\"project/run.tcl\",\"r\") as tcl_file:FileNotFoundError: [Errno 2] No such file or directory: 'project/run.tcl'\nHeteroCL canâ€™t find my Vivado HLS include files. So what we gotta do is to specify where the library files are located.\nI added following two lines in the ~/.bashrc file\n12export VIVADO_HLS_HOME=/home/zhangniansong/Vivado/2018.3export CPATH=$CPATH:$VIVADO_HLS_HOME/include\nCPATH is for g++ include directory. It is the same as -I.\nThen I reinstall HeteroCL, and Voila!\n12345678910111213141516171819INFO: [Common 17-206] Exiting vivado_hls at Sat Jul  4 16:07:47 2020...+-------------------+-----------------------------------+| HLS Version       | Vivado HLS 2018.3                 || Product family    | zynq                              || Target device     | xc7z020clg484-1                   || Top Model Name    | test                              |+-------------------+-----------------------------------+| Target CP         | 10.00 ns                          || Estimated CP      | 8.510 ns                          || Latency (cycles)  | Min 18308 ; Max 18308             || Interval (cycles) | Min 18309 ; Max 18309             || Resources         | Type        Used    Total    Util ||                   | --------  ------  -------  ------ ||                   | BRAM_18K       3      280      1% ||                   | DSP48E         3      220      1% ||                   | FF           496   106400      0% ||                   | LUT          756    53200      1% |+-------------------+-----------------------------------+[16:07:47] Execution complete\nVivado HLS backend now works.\n\nUnderstanding How HeteroCL worksTo understand how HeteroCL works, we try to answer following questions:\n\nHow is the IR defined?\nHow is the dataflow graph built?\n\nThe extended Halide IR system","dateCreated":"2020-06-05T07:41:18-04:00","dateModified":"2022-08-26T15:32:11-04:00","datePublished":"2020-06-05T07:41:18-04:00","description":"HeteroCL is a software-defined reconfigurable computing framework. It is composed of a Python-based DSL (Domain-Specific Language) and an FPGA compilation flow. ","headline":"On HeteroCL","image":["https://res.cloudinary.com/dxzx2bxch/image/upload/v1592753028/printed-circuit-board_oja4wl.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.zzzdavid.tech/HeteroCL/"},"publisher":{"@type":"Organization","name":"Niansong Zhang","sameAs":["https://github.com/zzzDavid","https://twitter.com/WW5bbaRC2F46nt6","https://www.linkedin.com/in/niansong-zhang-b7855a191","mailto:nz264@cornell.edu"],"image":"https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png","logo":{"@type":"ImageObject","url":"https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png"}},"url":"https://www.zzzdavid.tech/HeteroCL/","keywords":"FPGA","thumbnailUrl":"https://res.cloudinary.com/dxzx2bxch/image/upload/v1592753028/printed-circuit-board_oja4wl.jpg"}</script>
    <meta name="description" content="HeteroCL is a software-defined reconfigurable computing framework. It is composed of a Python-based DSL (Domain-Specific Language) and an FPGA compilation flow.">
<meta property="og:type" content="blog">
<meta property="og:title" content="On HeteroCL">
<meta property="og:url" content="https://www.zzzdavid.tech/HeteroCL/index.html">
<meta property="og:site_name" content="Niansong Zhang">
<meta property="og:description" content="HeteroCL is a software-defined reconfigurable computing framework. It is composed of a Python-based DSL (Domain-Specific Language) and an FPGA compilation flow.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://res.cloudinary.com/dxzx2bxch/image/upload/v1591322050/Screen_Shot_2020-06-05_at_09.53.57_v6rkbe.png">
<meta property="article:published_time" content="2020-06-05T11:41:18.000Z">
<meta property="article:modified_time" content="2022-08-26T19:32:11.146Z">
<meta property="article:author" content="Niansong Zhang">
<meta property="article:tag" content="FPGA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://res.cloudinary.com/dxzx2bxch/image/upload/v1591322050/Screen_Shot_2020-06-05_at_09.53.57_v6rkbe.png">
    
    
        
    
    
        <meta property="og:image" content="https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png"/>
    
    
        <meta property="og:image" content="https://res.cloudinary.com/dxzx2bxch/image/upload/v1592753028/printed-circuit-board_oja4wl.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://res.cloudinary.com/dxzx2bxch/image/upload/v1592753028/printed-circuit-board_oja4wl.jpg"/>
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-uooilepu7vf0f3bxc06xvullo1wslswnxntpb3tidtsbf7b94rbib1icbwwr.min.css">

    <!--STYLES END-->
    

    

    
        
    
    <script>
        var scr = document.createElement('script');
        var namespace = 'zzzdavid.tech.' + location.pathname;
        var src = "https://api.countapi.xyz/hit/" + namespace + "?callback=websiteVisits";
        scr.setAttribute('src', src);
        document.getElementsByTagName('head')[0].appendChild(scr)
    </script>
<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-straight/css/uicons-regular-straight.css'><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container {
  overflow: auto hidden;
}

mjx-container + br {
  display: none;
}
</style><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container {
  overflow: auto hidden;
}

mjx-container + br {
  display: none;
}
</style></head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/%20"
            aria-label=""
        >
            Niansong Zhang
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="/"
                aria-label="Open the link: //"
            >
        
        
            <img class="header-picture" src="https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Niansong Zhang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>I am an MS/PhD  student at Computer System Lab, Cornell University.<br>This website is a personal/academic blog for me to write  about my projects, readings, also thoughts, and retrospectives.</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-address-card" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/blog/"
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/pdf/CV-niansong.pdf"
                            
                            title="Resume/CV"
                        >
                    
                        <i class="sidebar-button-icon fa fa-user-graduate" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Resume/CV</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/zzzDavid" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/WW5bbaRC2F46nt6" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/niansong-zhang-b7855a191" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:nz264@cornell.edu" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            On HeteroCL
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2020-06-05T07:41:18-04:00">
	
		    Jun 05, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Tutorial/">Tutorial</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <div style="overflow: hidden; white-space: nowrap;"">
                <i> <img src="https://res.cloudinary.com/dxzx2bxch/image/upload/v1658049100/book-alt_gzq2mb.svg" width="15" height="15" align="left"  style="position:relative;top:8px;" /> 
                &nbsp;&nbsp;This page has been visited <span id="view_count_text"> </span> times </i>
            </div>
            <!-- excerpt -->
<p>Welcome to my notes on HeteroCL. </p>
<h2 id="How-do-we-install-HeteroCL"><a href="#How-do-we-install-HeteroCL" class="headerlink" title="How do we install HeteroCL?"></a>How do we install HeteroCL?</h2><p>To install HeteroCL, simple clone it from GitHub.<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">clone</span> <span class="title">--recursive</span> https://github.com/cornell-zhang/heterocl.git</span><br></pre></td></tr></table></figure></p>
<p>After that, go to the downloaded directory and make it.<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>make -j8</span><br></pre></td></tr></table></figure></p>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><ol>
<li>You can set your own CMake or LLVM version by setting the PATH in <code>Makefile.config</code>.</li>
<li>You can turn off the VHLS C simulation feature by setting <code>USE_VIVADO_HLS</code> to 0 in <code>Makefile.config</code>.</li>
</ol>
<h2 id="Components-of-HeteroCL"><a href="#Components-of-HeteroCL" class="headerlink" title="Components of HeteroCL"></a>Components of HeteroCL</h2><div class="figure center" style="width:;"><img class="fig-img" src="https://res.cloudinary.com/dxzx2bxch/image/upload/v1591322050/Screen_Shot_2020-06-05_at_09.53.57_v6rkbe.png" alt="HeteroCL framework overview"><span class="caption">HeteroCL framework overview</span></div>
<p>HeteroCL is High-Level-Synthesis with style. How is that so? Previous HLS tools, for example, Vivado HLS, need us users to specify hardware customizations while describing the function, so that it could generate correct circuits from that description. HeteroCL does exactly the same job, but it decouples the hardware customization from algorithm specification, allowing a cleaner programming process. </p>
<h3 id="Relation-with-TVM"><a href="#Relation-with-TVM" class="headerlink" title="Relation with TVM"></a>Relation with TVM</h3><p>HeteroCL is like an extension from TVM in the sense of compiler. TVM focuses on Tensor computations for CPU and GPU backends. Though TVM supports FPGA backend by using VTA, its tensor operations are pre-defined. On the other hand, HeteroCL offers additional features for FPGA programming that are more flexible and general. Such features include:</p>
<ul>
<li>Decoupled Algorithm/Hardware specification</li>
<li>Imperative programming for general applications</li>
<li>Various hardware customization primitives</li>
<li>Bit-accurate data types</li>
</ul>
<h2 id="Workflow-of-HeteroCL"><a href="#Workflow-of-HeteroCL" class="headerlink" title="Workflow of HeteroCL"></a>Workflow of HeteroCL</h2><p>Basic steps to use HeteroCL include:</p>
<ol>
<li>Import HeteroCL <code>import heterocl as hcl</code></li>
<li>Initialize Environment <code>hcl.init()</code></li>
<li>Define Algorithm</li>
<li>Define Inputs/Outputs <code>hcl.placeholder()</code></li>
<li>Apply Hardware Customization <code>s= hcl.create_schedule</code>  </li>
<li>View lower IR <code>hcl.lower(s)</code></li>
<li>Create Executable <code>f = hcl.build()</code></li>
<li>Run Executable <code>f()</code></li>
</ol>
<p>For FPGA backend HeteroCL generates HLS code. For CPU backend it generates a executable.</p>
<h2 id="Tutorials"><a href="#Tutorials" class="headerlink" title="Tutorials"></a>Tutorials</h2><p><a href="http://heterocl.csl.cornell.edu/doc/tutorials/tutorial_03_api.html" target="_blank" rel="noopener">Quick Link</a></p>
<h3 id="Using-Vivado-HLS-Backend-for-csynth-csim"><a href="#Using-Vivado-HLS-Backend-for-csynth-csim" class="headerlink" title="Using Vivado HLS Backend for csynth/csim"></a>Using Vivado HLS Backend for csynth/csim</h3><p>A simple HLS backend example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heterocl <span class="keyword">as</span> hcl</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gemm</span><span class="params">(m=<span class="number">16</span>, n=<span class="number">16</span>, k=<span class="number">16</span>, dtype=hcl.Int<span class="params">()</span>, target=None)</span>:</span></span><br><span class="line">    matrix_1 = hcl.placeholder((m, k), dtype=dtype)</span><br><span class="line">    matrix_2 = hcl.placeholder((k, n), dtype=dtype)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">kernel</span><span class="params">(matrix_1, matrix_2)</span>:</span></span><br><span class="line">        r = hcl.reduce_axis(<span class="number">0</span>, k, <span class="string">'k'</span>)</span><br><span class="line">        <span class="keyword">return</span> hcl.compute((m, n),</span><br><span class="line">                <span class="keyword">lambda</span> x, y: hcl.sum(matrix_1[x, r] * matrix_2[r, y],</span><br><span class="line">                                     axis=r, dtype=dtype),</span><br><span class="line">                dtype=dtype,</span><br><span class="line">                name=<span class="string">"out_matrix"</span>)</span><br><span class="line"></span><br><span class="line">    s = hcl.create_schedule([matrix_1, matrix_2], kernel)</span><br><span class="line">    s.to([matrix_1, matrix_2], target.xcel)</span><br><span class="line">    s.to(kernel.out_matrix, target.host)</span><br><span class="line">    f = hcl.build(s, target=target)</span><br><span class="line">    <span class="keyword">return</span> f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target = hcl.platform.zc706</span><br><span class="line">target.config(compile=<span class="string">"vivado_hls"</span>, mode=<span class="string">"csim|csyn"</span>)</span><br><span class="line"></span><br><span class="line">m = k = n = <span class="number">16</span></span><br><span class="line">dtype = hcl.Int()</span><br><span class="line">hcl_m1 = hcl.asarray(np.random.randint(<span class="number">10</span>, size=(m, k)), dtype=hcl.Int())</span><br><span class="line">hcl_m2 = hcl.asarray(np.random.randint(<span class="number">10</span>, size=(m, k)), dtype=hcl.Int())</span><br><span class="line">hcl_m3 = hcl.asarray(np.zeros((m, n)), dtype=dtype)</span><br><span class="line"></span><br><span class="line">fg = gemm(m, n, k, dtype=hcl.Int(), target=target)</span><br><span class="line">fg(hcl_m1, hcl_m2, hcl_m3)</span><br><span class="line"></span><br><span class="line">report = fg.report(target)</span><br></pre></td></tr></table></figure>
<p>With above installation steps and Vivado Design Suite 2018.3 installed, I could not get HLS backend working.<br>See the below error message:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[15:27:16] Generating harness files ...</span><br><span class="line">[15:27:16] Compiling the program ...</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"hls_backend_example.py"</span>, line <span class="number">36</span>, <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;</span><br><span class="line">    fg(hcl_m1, hcl_m2, hcl_m3)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/function.py"</span>, line <span class="number">128</span>, <span class="keyword">in</span> __call__</span><br><span class="line">    <span class="keyword">return</span> f(*args)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/_ctypes/function.py"</span>, line <span class="number">183</span>, <span class="keyword">in</span> __call__</span><br><span class="line">    ctypes.byref(ret_val), ctypes.byref(ret_tcode)))</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/base.py"</span>, line <span class="number">66</span>, <span class="keyword">in</span> check_call</span><br><span class="line">    <span class="keyword">raise</span> TVMError(py_str(_LIB.TVMGetLastError()))</span><br><span class="line">heterocl.tvm._ffi.base.TVMError: TVMCall CFunc <span class="keyword">Error</span>:</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/_ffi/_ctypes/function.py"</span>, line <span class="number">54</span>, <span class="keyword">in</span> cfun</span><br><span class="line">    rv = local_pyfunc(*pyargs)</span><br><span class="line">  <span class="keyword">File</span> <span class="string">"/home/zhangniansong/.local/lib/python3.7/site-packages/heterocl-0.1-py3.7.egg/heterocl/tvm/runtime.py"</span>, line <span class="number">153</span>, <span class="keyword">in</span> copy_and_compile</span><br><span class="line">    <span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">"project/run.tcl"</span>,<span class="string">"r"</span>) <span class="keyword">as</span> tcl_file:</span><br><span class="line">FileNotFoundError: [Errno <span class="number">2</span>] <span class="keyword">No</span> such <span class="keyword">file</span> <span class="keyword">or</span> <span class="keyword">directory</span>: <span class="string">'project/run.tcl'</span></span><br></pre></td></tr></table></figure>
<p>HeteroCL canâ€™t find my Vivado HLS include files. So what we gotta do is to specify where the library files are located.</p>
<p>I added following two lines in the <code>~/.bashrc</code> file</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> VIVADO_HLS_HOME=/home/zhangniansong/Vivado/2018.3</span><br><span class="line"><span class="built_in">export</span> CPATH=<span class="variable">$CPATH</span>:<span class="variable">$VIVADO_HLS_HOME</span>/include</span><br></pre></td></tr></table></figure>
<p><code>CPATH</code> is for g++ include directory. It is the same as <code>-I</code>.</p>
<p>Then I reinstall HeteroCL, and Voila!</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">INFO: [Common 17-206] Exiting vivado_hls at Sat Jul  4 16:07:47 2020...</span><br><span class="line">+-------------------+-----------------------------------+</span><br><span class="line">|<span class="string"> HLS Version       </span>|<span class="string"> Vivado HLS 2018.3                 </span>|</span><br><span class="line">|<span class="string"> Product family    </span>|<span class="string"> zynq                              </span>|</span><br><span class="line">|<span class="string"> Target device     </span>|<span class="string"> xc7z020clg484-1                   </span>|</span><br><span class="line">|<span class="string"> Top Model Name    </span>|<span class="string"> test                              </span>|</span><br><span class="line">+-------------------+-----------------------------------+</span><br><span class="line">|<span class="string"> Target CP         </span>|<span class="string"> 10.00 ns                          </span>|</span><br><span class="line">|<span class="string"> Estimated CP      </span>|<span class="string"> 8.510 ns                          </span>|</span><br><span class="line">|<span class="string"> Latency (cycles)  </span>|<span class="string"> Min 18308 ; Max 18308             </span>|</span><br><span class="line">|<span class="string"> Interval (cycles) </span>|<span class="string"> Min 18309 ; Max 18309             </span>|</span><br><span class="line">|<span class="string"> Resources         </span>|<span class="string"> Type        Used    Total    Util </span>|</span><br><span class="line">|<span class="string">                   </span>|<span class="string"> --------  ------  -------  ------ </span>|</span><br><span class="line">|<span class="string">                   </span>|<span class="string"> BRAM_18K       3      280      1% </span>|</span><br><span class="line">|<span class="string">                   </span>|<span class="string"> DSP48E         3      220      1% </span>|</span><br><span class="line">|<span class="string">                   </span>|<span class="string"> FF           496   106400      0% </span>|</span><br><span class="line">|<span class="string">                   </span>|<span class="string"> LUT          756    53200      1% </span>|</span><br><span class="line">+-------------------+-----------------------------------+</span><br><span class="line">[16:07:47] Execution complete</span><br></pre></td></tr></table></figure>
<p>Vivado HLS backend now works.</p>
<hr>
<h1 id="Understanding-How-HeteroCL-works"><a href="#Understanding-How-HeteroCL-works" class="headerlink" title="Understanding How HeteroCL works"></a>Understanding How HeteroCL works</h1><p>To understand how HeteroCL works, we try to answer following questions:</p>
<ol>
<li>How is the IR defined?</li>
<li>How is the dataflow graph built?</li>
</ol>
<h2 id="The-extended-Halide-IR-system"><a href="#The-extended-Halide-IR-system" class="headerlink" title="The extended Halide IR system"></a>The extended Halide IR system</h2>
            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/FPGA/" rel="tag">FPGA</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/loop_opt/"
                    data-tooltip="Loop Optimization in HLS"
                    aria-label="PREVIOUS: Loop Optimization in HLS"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/NAS/"
                    data-tooltip="Neural Architecture Search, Basic Concepts, Paper Summary and Implementations"
                    aria-label="NEXT: Neural Architecture Search, Basic Concepts, Paper Summary and Implementations"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zzzdavid.tech/HeteroCL/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://www.zzzdavid.tech/HeteroCL/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
    <script type="application/javascript">
        function websiteVisits(response) {
          document.getElementById("view_count_text").textContent = response.value;
        }
    </script>
</article>

                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2023 Niansong Zhang. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/loop_opt/"
                    data-tooltip="Loop Optimization in HLS"
                    aria-label="PREVIOUS: Loop Optimization in HLS"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/NAS/"
                    data-tooltip="Neural Architecture Search, Basic Concepts, Paper Summary and Implementations"
                    aria-label="NEXT: Neural Architecture Search, Basic Concepts, Paper Summary and Implementations"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.zzzdavid.tech/HeteroCL/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://www.zzzdavid.tech/HeteroCL/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://www.zzzdavid.tech/HeteroCL/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://www.zzzdavid.tech/HeteroCL/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://res.cloudinary.com/dxzx2bxch/image/upload/v1603333481/posts/Screen_Shot_2020-10-22_at_10.24.31_hfpnrc.png" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Niansong Zhang</h4>
        
            <div id="about-card-bio"><p>I am an MS/PhD  student at Computer System Lab, Cornell University.<br>This website is a personal/academic blog for me to write  about my projects, readings, also thoughts, and retrospectives.</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Cornell University</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Ithaca, NY
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://res.cloudinary.com/dxzx2bxch/image/upload/v1603335200/posts/gradient_rbcdse.png');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-fhmarkacoap4j3albrpiwduhz4eum3yksihvkymljovnyngmsd1yjgifc0ho.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://www.zzzdavid.tech/HeteroCL/';
              
            this.page.identifier = 'HeteroCL/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'niansong-zhangs-blog';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
