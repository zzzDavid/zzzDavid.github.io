<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Niansong Zhang</title>
  
  <subtitle>Blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-04-14T12:30:48.573Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Niansong Zhang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>板材检测库V2.1文档</title>
    <link href="http://yoursite.com/2019/04/13/%E6%9D%BF%E6%9D%90%E6%A3%80%E6%B5%8B%E5%BA%93V2-1%E6%96%87%E6%A1%A3/"/>
    <id>http://yoursite.com/2019/04/13/板材检测库V2-1文档/</id>
    <published>2019-04-13T15:42:01.000Z</published>
    <updated>2019-04-14T12:30:48.573Z</updated>
    
    <content type="html"><![CDATA[<p>GitHub代码地址为：<a href="https://github.com/Patrick22414/MeasurePlate.git" target="_blank" rel="noopener">MeasurePlate</a>，这是一个私人仓库，需要相应的权限才可以进入。项目环境配置：</p><pre><code>- Visual Studio 2015及以上- .netFramework 4.6以上 （推荐使用4.7.2）- .netFramework 开发环境- OpenCvSharp4.Windows- NUnit（UnitTest测试用，非必要）</code></pre><hr><h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><pre><code>Measure                             Project名称|-------UnitTests.cs                单元测试文件|-------src        |------Circles.cs           检测内部孔        |------Curves.cs            检测外轮廓中曲线        |------Lines.cs             检测外轮廓中直线        |------MeasurePlates.cs     Constructor与Destructor        |------Rectangular.cs       当板材为矩形板时，检测角点与长宽对角线差        |------Slots.cs             检测铣槽与锯槽        |------TestAPIs.cs          测试中查看Private成员使用的API        |______Utils.cs             工具函数</code></pre><h2 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h2><p>此项目的全部代码使用一个命名空间<code>Measure</code>, 并且整个库只包含一个类<code>MeasurePlate</code>。此类中包含7个功能函数，分别实现板材检测的某一个功能。功能函数的名称与作用如下：<br>下表中所有函数输出变量<code>status</code>表示函数执行状态，输入<code>unit</code>代表输出数据的单位，默认毫米，后不再赘述。</p><table><thead><tr><th style="text-align:center">函数名称</th><th style="text-align:center">输入输出</th><th style="text-align:left">函数功能</th></tr></thead><tbody><tr><td style="text-align:center"><code>FourCorners(out float[] corners)</code></td><td style="text-align:center">corners为<code>float[8]</code>，分别为从左上角开始顺时针四角的坐标。</td><td style="text-align:left">检测矩形板的四个角点坐标</td></tr><tr><td style="text-align:center"><code>WidthHeightDiagonal(out float[] lengths)</code></td><td style="text-align:center">lengths为<code>float[3] {宽、高、对角线差}</code></td><td style="text-align:left">检测矩形板的宽高与对角线差</td></tr><tr><td style="text-align:center"><code>Lines(out List&lt;float[]&gt; lines)</code></td><td style="text-align:center">lines为<code>float[5]</code>的List，每个数组分别为<code>{X1, Y1, X2, Y2, 直线长}</code></td><td style="text-align:left">检测外轮廓中的直线位置与长度</td></tr><tr><td style="text-align:center"><code>Curves(out List&lt;float[]&gt; curves)</code></td><td style="text-align:center">curves为<code>float[3]</code>的List，每个数组代表一个弧线边所在圆，分别为<code>{圆心X，圆心Y，半径}</code></td><td style="text-align:left">检测外轮廓弧线边对应的相切圆的位置与半径</td></tr><tr><td style="text-align:center"><code>Circles(out List&lt;float[]&gt; circles)</code></td><td style="text-align:center">circles为<code>float[3]</code>的List，每个数组代表一个圆孔，分别为<code>{圆心X，圆心Y，半径}</code></td><td style="text-align:left">检测内部圆孔的圆心位置与半径</td></tr><tr><td style="text-align:center"><code>MillSlot(out List&lt;float[]&gt; slots)</code></td><td style="text-align:center">slots为<code>float[8]</code>代表矩形铣槽的四点X，Y坐标，分别为<code>{Ax，Ay，Bx，……，Dx，Dy}</code></td><td style="text-align:left">检测铣槽的四个角点</td></tr><tr><td style="text-align:center"><code>SawSlot(out List&lt;float[]&gt; slots)</code></td><td style="text-align:center">sslots为<code>float[6]</code>的List，每个数组代表一个矩形锯槽，分别为<code>{中心X，中心Y，宽，高，角度，朝向（0为纵向，1为横向）}</code></td><td style="text-align:left">检测锯槽的位置与信息</td></tr></tbody></table><hr><h2 id="项目代码解析"><a href="#项目代码解析" class="headerlink" title="项目代码解析"></a>项目代码解析</h2><h3 id="1-MeasurePlate-cs"><a href="#1-MeasurePlate-cs" class="headerlink" title="1. MeasurePlate.cs"></a>1. MeasurePlate.cs</h3><p><code>MeasurePlate.cs</code>包含类的Constructor与Destructor. Constructor承担了大部分计算任务，其主要功能是在实例化的同时初始化后面检测函数要用到的数据，比如原图与亮度调整后的图；同时，为了避免重复计算，Constructor从图中提取板材的内外轮廓。</p><h4 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h4><p>Constructor的工作流程：找ROI -&gt; 从整张图片截取ROI部分 -&gt; 计算参数 -&gt; 确定内外轮廓</p><pre><code class="java">public MeasurePlate(string filename, float ratio = 0.11F){    var image = 读入灰度图;    var smallImage = 缩小(image);    var largestContour = 二值化并找最大外轮廓(smallImage);    板材灰度均值 = Mean(最大轮廓内区域)    _roi = 外接矩形（largestContour）* 扩大倍数    _roiEx = 扩张(roi) * 扩大倍数    _im = image中_roiEx的部分    _imAdjusted = 亮度调整(_im)    外轮廓 = _SetExtContour();    内轮廓 = _SetIntContour(); }</code></pre><h4 id="SetExtContour"><a href="#SetExtContour" class="headerlink" title="SetExtContour()"></a>SetExtContour()</h4><p>这是对参数非常敏感且对检测结果影响很大的一部分。在原来的图片素材中由于板材分亮暗，锯槽会不会把板材分为两部分等多种情况，所以这里主要采用分类讨论的办法。分类讨论的依据就是板材的灰度均值，板材外轮廓是否被锯槽分为两部分等等。只有正确检测了外轮廓，才能得到正确的直线检测与弧线检测结果。</p><pre><code class="java">private Point[] _SetExtContour(){    预处理    使用OTSU法尝试第一次二值化，寻找外轮廓    统计面积大于1e5的外轮廓的个数n    if (n &gt; 1)        板材被锯槽分为多个部分    _extContour = 最大的外轮廓    extPoly = 多边形拟合(_extContour)    if (extPoly中包含的点太多了 || 板材被锯槽分为多个部分)    {        重新使用固定阈值二值化，并分情况讨论        var threshold = 0        if (板材比较亮 &amp;&amp; 没有锯槽 &amp;&amp; extPoly中包含的点不是特别多)        {            这是外轮廓上有破边孔的亮色板            threshold = 240        }        else if (板材比较亮 &amp;&amp; 没有锯槽 &amp;&amp; extPoly中包含的点太多了)        {            这是比较亮的板，但是OSTU法让它的外轮廓损坏严重            threshold = 80        }        else if (板材稍微暗 &amp;&amp; 没有锯槽)        {            threshold = 80        }        else if (板材很亮 &amp;&amp; 有锯槽)        {            threshold = 80            定一个很低的阈值来得到完整的外轮廓        }        else            thresold = 45 对于暗色板        使用threshold二值化        寻找外轮廓        _extContour = 最大的外轮廓    }}</code></pre><h3 id="2-Rectangular-cs"><a href="#2-Rectangular-cs" class="headerlink" title="2. Rectangular.cs"></a>2. Rectangular.cs</h3><p><code>Rectangular.cs</code> 包含两个相互独立的函数。这两个函数在仅仅应用外轮廓的结果计算需要返回的量。这两部分代码基本上不被调用。</p><h4 id="FourCorners"><a href="#FourCorners" class="headerlink" title="FourCorners"></a>FourCorners</h4><pre><code class="java">public bool FourCorners(out float[] corners, out string status){    找到外轮廓最小外接矩形    返回最小外接矩形的四个角点坐标}</code></pre><h4 id="WidthHeighDiagonal"><a href="#WidthHeighDiagonal" class="headerlink" title="WidthHeighDiagonal"></a>WidthHeighDiagonal</h4><pre><code class="java">public bool WidthHeightDiagonal (oiut float[] lengths, out stirng status){    var polygon = 多边形拟合(_extContour)    计算多边形中心点    根据与中心的相对位置确定上下左右四个角点    计算宽，高，对角线差}</code></pre><h3 id="3-Circles-cs"><a href="#3-Circles-cs" class="headerlink" title="3. Circles.cs"></a>3. Circles.cs</h3><p>孔检测，包含两个函数<code>Circles</code>和<code>_MergeCircles</code>，其中<code>_MergeCircles</code>被<code>Circles</code>调用，其作用是合并距离很近的多个孔检测结果。<code>Circles</code>是孔检测的主要函数。</p><h4 id="Circles"><a href="#Circles" class="headerlink" title="Circles"></a>Circles</h4><pre><code class="C#">public bool Circles(out List&lt;float[]&gt; circles, out string status){    // 找内轮廓中的圆形    if (板材是暗色板)    {        imDarkBin = 预处理并且缩小(_im);        imDarkBin = Canny(imDarkBin)        for (r = 20; r&lt;=30; r+=2)        {            houghCircles = cv2.HoughCircles(imDarkBin, r);        }        avgCircles = _MergeCircles(houghCircles);        circles0 = 放大(avgCircles)    }    else //板材不是暗色板    {        foreach (var contour in _intContours)        {            rect = 外接矩形(contour)            if(rect的长或宽太小)                continue            area = 求轮廓面积(contour)            if(area太小 || area/矩形面积太小)                continue            hull = cv2.ConvexHull(contour)            circle = 最小二乘法圆拟合(hull)            circles1.Add(circle)        }        circles1 = 去除重叠的圆(circles1)    }    // 找外轮廓中的圆形    imOut = 将板材外轮廓附近的图像抠出来(_im);    imCanny = Canny(imOut)    imOut = cv2.GaussianBlur(imOut, Mean(imCanny));    for (i = 24; i&lt;=30; i+=2)    {        houghCircles2 = cv2.HoughCircle(imOut, i)    }    circles2 = houghCircles2    // 合并结果    circles3 = _MergeCircles(circles0, circles1, circles2)}</code></pre><p>这里<code>_MergeCircles</code>是一个帮助函数，它的作用是将圆心邻近并且半径大小差不多的圆合并成一个圆。</p><h3 id="4-Curves-cs"><a href="#4-Curves-cs" class="headerlink" title="4. Curves.cs"></a>4. Curves.cs</h3><h4 id="Curves"><a href="#Curves" class="headerlink" title="Curves"></a>Curves</h4><p><code>Curves</code>函数是用来检测外轮廓上的弧线的。需要注意的是，如果外轮廓上的弧线超过了半圆，则算作破边孔，不包括在曲线检测之内。</p><pre><code class="C#">public bool Curves(out List&lt;float[]&gt; curves, out string status){    points = new List&lt;Point&gt;(_extPolygon);    // 这个函数分析外轮廓上的所有点，返回一个与外轮廓上点的数目相同的数组    // 数组中是0或1，对应于外轮廓上的每一个点    // 如果该点在弧线上则对应1，否则对应0    var isOnCircle = _AnalyzePointsOnCircle(Points);    //为了让所有在外轮廓上的点连续(一条弧线的点不会分别出现在数组开头和结尾)    //需要对数组旋转    while(isOnCircle最后一个元素==1)    {        isOnCircle = 旋转(isOnCircle);        points = 旋转(Points);    }    // 计算圆的方程    for (;;)    {        curve = inOnCircle中每段连续的1;        circle = 最小二乘法拟合圆的方程(curve)    }}</code></pre><h3 id="5-Lines-cs"><a href="#5-Lines-cs" class="headerlink" title="5. Lines.cs"></a>5. Lines.cs</h3><p><code>Lines.cs</code>只包含一个函数<code>Line</code>，用来检测外轮廓上的直线。</p><h4 id="Lines"><a href="#Lines" class="headerlink" title="Lines"></a>Lines</h4><pre><code class="C#">public bool Lines(out List&lt;float[]&gt; lines, out string status){    points = new List&lt;Point&gt;(_exPolygon);    n = points.长度    if ( n &lt; 3)        ERROR(&quot;点太少了&quot;)    if (是矩形板)    {        if(n ==5)        {            点多了一个，尝试减少一个点        }        //去除了一个点之后有4个点，生成直线        for(var i=0; i&lt;4; i++)            lines.Add(两点确定的直线)    }    else    {        // 这个函数分析外轮廓上的所有点，返回一个与外轮廓上点的数目相同的数组        // 数组中是0或1，对应于外轮廓上的每一个点        // 如果该点在弧线上则对应1，否则对应0        var isOnCircle = _AnalyzePointsOnCircle(points)        然后根据isOnCircle的信息把直线添加到lines中    }}</code></pre><h3 id="6-Slots-cs"><a href="#6-Slots-cs" class="headerlink" title="6. Slots.cs"></a>6. Slots.cs</h3><p><code>Slots.cs</code>包含两个函数，分别负责检测锯槽与铣槽。</p><h4 id="MillSlot"><a href="#MillSlot" class="headerlink" title="MillSlot"></a>MillSlot</h4><p>铣槽的检测方法十分简单，在Constructor中已经提取了内轮廓，所以就利用提取的内轮廓，从中筛选出近似矩形的轮廓即可</p><pre><code class="C#">public bool MillSlot(out List&lt;float[]&gt; slots, out string status){    // 判断内轮廓是否为矩形    foreach (var intContour in _intContours)    {        box = 最小外接矩形(intContour);        areaOfContour = 求轮廓面积(intContour)        areaOfBox = box.Width * box.height        if(!_IsCircularContour(intContour) &amp;&amp; areaOfContour足够大 &amp;&amp;             areaofContour/areaofBox &gt; 1.1 * PI/4)            SlotContour.Add(intContour)    }    // 根据SlotContour计算需要返回的值}</code></pre><h4 id="SawSlot"><a href="#SawSlot" class="headerlink" title="SawSlot"></a>SawSlot</h4><p><code>SawSlot</code>相对比较复杂，它主要将槽分为两种方法检测。一种是亮色板的锯槽，因为这种锯槽会把板面分为两部分，这样就会出现两个较大的轮廓。另一种是暗色板的槽，这种槽内部有很多干扰的噪声，这种槽就利用Canny提取纹理信息，利用槽内部的花纹检测。</p><pre><code class="C#">public bool SawSlot(out list&lt;float[]&gt; slots, out string status){    if (不是亮色板||没有两个较大的轮廓||不是矩形板)    {        去除背景噪声        根据_mean分类讨论，二值化并进行Canny操作得到imCanny        lineSegments = 霍夫直线(imCanny);        horizontal = 选出所有横线(lineSegments)        vertical = 选出所有竖线(lineSegments)        将横线竖线分别画在两张图上，并且膨胀        分别提取所有轮廓，找到外接矩形面积最大的轮廓，这些轮廓就是槽    }    else    {        转到FindSlotRect函数，返回槽的信息    }}</code></pre><h4 id="FindSlotRect"><a href="#FindSlotRect" class="headerlink" title="FindSlotRect"></a>FindSlotRect</h4><p>这个函数是专门用来处理亮色板锯槽的函数，因为亮色板的锯槽会把板面分成几个部分，所以二值化之后就产生多个外轮廓</p><pre><code class="C#">private List&lt;float[]&gt; FindSlotRect(){    预处理    extContours = 找到所有外轮廓()    boxes = 找到所有外接矩形(extContours)    根据boxes中前两个box的位置关系判断槽是横的还是竖的    if(横的)        boxes.从左到右排序    else        boxes.从上到下排序    这时相邻两个box之间就是一个槽，按顺序找到槽的位置，并返回}</code></pre><h3 id="7-Util-cs"><a href="#7-Util-cs" class="headerlink" title="7. Util.cs"></a>7. Util.cs</h3><p>这里全部都是帮助函数，这些函数基本不需要修改，因此下面仅列出这些函数的函数名与对应的功能</p><table><thead><tr><th style="text-align:center">函数名称</th><th style="text-align:center">函数功能</th></tr></thead><tbody><tr><td style="text-align:center"><code>_Distance</code></td><td style="text-align:center">计算两点之间距离</td></tr><tr><td style="text-align:center"><code>_AngleOfLine</code></td><td style="text-align:center">计算直线与水平夹角</td></tr><tr><td style="text-align:center"><code>_AngleOfPath</code></td><td style="text-align:center">计算三个点确定的两条直线的夹角</td></tr><tr><td style="text-align:center"><code>_LargestContourByRect</code></td><td style="text-align:center">输入一组轮廓，返回这些轮廓中外接矩形面积最大的轮廓</td></tr><tr><td style="text-align:center"><code>_LargestContourByArea</code></td><td style="text-align:center">输入一组轮廓，返回这些轮廓中面积最大的轮廓</td></tr><tr><td style="text-align:center"><code>_LargestRectsByArea</code></td><td style="text-align:center">输入一组矩形，返回一个或多个面积较大的矩形</td></tr><tr><td style="text-align:center"><code>_isCircularContour</code></td><td style="text-align:center">判断一个轮廓是否为近似圆的轮廓</td></tr><tr><td style="text-align:center"><code>_AnalyzePointsOnCircle</code></td><td style="text-align:center">分析轮廓所有点，返回一个与输入数组同样大小的数组，对应输入数组中的每个点，如果该点在曲线上则对应位置为1，反之为0</td></tr><tr><td style="text-align:center"><code>_LSCircleFitting</code></td><td style="text-align:center">最小二乘法圆拟合</td></tr><tr><td style="text-align:center"><code>_imAdjust</code></td><td style="text-align:center">调整暗色板亮度</td></tr><tr><td style="text-align:center"><code>_IsSawSlot</code></td><td style="text-align:center">判断轮廓是否为锯槽</td></tr><tr><td style="text-align:center"><code>_SmartLines</code></td><td style="text-align:center">智能直线，将外轮廓上的毛刺，拐角缺损等去掉，达到理想的外轮廓检测效果</td></tr><tr><td style="text-align:center"><code>_InterSection4</code></td><td style="text-align:center">计算四个点确定给的两条直线的交点</td></tr><tr><td style="text-align:center"><code>_Entropy</code></td><td style="text-align:center">计算图像的熵</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;GitHub代码地址为：&lt;a href=&quot;https://github.com/Patrick22414/MeasurePlate.git&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MeasurePlate&lt;/a&gt;，这是一个私人仓库，需要相应的权限才可
      
    
    </summary>
    
      <category term="Documents" scheme="http://yoursite.com/categories/Documents/"/>
    
    
      <category term="CV" scheme="http://yoursite.com/tags/CV/"/>
    
  </entry>
  
  <entry>
    <title>Goodbye to All That</title>
    <link href="http://yoursite.com/2019/04/09/Goodbye-to-All-That/"/>
    <id>http://yoursite.com/2019/04/09/Goodbye-to-All-That/</id>
    <published>2019-04-09T15:41:18.000Z</published>
    <updated>2019-04-09T16:02:09.139Z</updated>
    
    <content type="html"><![CDATA[<p>  “All I mean is that I was very young in New York, and that at some point the golden rhythm was broken, and I am not that young anymore.”<br>  — Joan Didion</p><hr><p>How many miles to Babylong?</p><p>Three score miles and and ten—</p><p>Can I get there by candlelight?</p><p>Yes, and back again—</p><p>If your feet are nimble and light</p><p>You can get there by candlelight.</p><hr><p>It is easy to see the beginnings of things, and harder to see the ends. I can remember now, with a clarity that makes the nerves in the back of my neck constrict, when New York began for me, but I cannot lay my  finger upon the moment it ended, can never cut through the ambiguities and second starts and broken resolves to the exact place on the page where the heroine is no longer as optimistic as she once was. When I first saw New York I was twenty, and it was summertime, and I got off a DC-7 at the old Idlewild temporary terminal in a new dress which had seemed very smart in Sacramento but seemed less smart already, even in  the old Idlewild temporary terminal, and the warm air smelled of mildew and some instinct, programmed by all the movies I had ever seen and all the songs I had ever read about New York, informed me that it would never be quite the same again. In fact it never was. Some time later there was a song in the jukeboxes on the Upper East Side that went “but where is the schoolgirl who used to be me,” and if it was late enough at night I used to wonder that. I know now that almost everyone wonders something like that, sooner or later and no matter what he or she is doing, but one of the mixed blessings of being twenty and twenty-one and even twenty-three is the conviction that nothing like this, all evidence to the contrary notwithstanding, has ever happened to anyone before.</p><p>Of course it might have been some other city, had circumstances been different and the time been different and had I been different, might have been Paris or Chicago or even San Francisco, but because I am talking about myself I am talking here about New York. That first night I opened my window on the bus into town and watched for the skyline, but all I could see were the wastes of Queens and big signs that said MIDTOWN TUNNEL THIS LANE and then a flood of summer rain (even that seemed remarkable and exotic, for I had come out of the West where there was no summer rain), and for the next three days I sat wrapped in blankets in a hotel room air conditioned to 35 degrees and tried to get over a cold and a high fever. It did not occur to me to call a doctor, because I knew none, and although it did occur to me to call the desk and ask that the air conditioner be turned off, I never called, because I did not know how much to tip whoever might come—was anyone ever so young? I am here to tell you that someone was. All I could do during those years was talk long-distance to the boy I already knew I would never marry in the spring. I would stay in New York, I told him, just six months, and I could see the Brooklyn Bridge from my window. As it turned out the bridge was the Triborough, and I stayed eight years.</p><hr><p>In retrospect it seems to me that those days before I knew the names of all the bridges were happier than the ones that came later, but perhaps you will see that as we go along. Part of what I want to tell you is what it is like to be young in New York, how six months can become eight years with the deceptive ease of a film dissolve, for that is how those years appear to me now, in a long sequence of sentimental dissolves and old-fashioned trick shots—the Seagram Building fountains dissolve into snowflakes, I enter a revolving door at twenty and come out a good deal older, and on a different street. But most particularly I want to explain to you, and in the process perhaps to myself, why I no longer live in New York. It is often said that New York is a city for only the very rich and the very poor. It is less often said that New York is also, at least for those of us who came there from somewhere else, a city only for the very young.</p><p>I remember once, one cold bright December evening in New York, suggesting a friend who complained of having been around too long that he come with me to a party where there would be, I assured him with the bright resourcefulness of twenty-three, “new faces.” He laughed literally until he choked, and I had to roll down the taxi window and hit him on the back. “New faces,” he said finally, “don’t tell me about new faces.” It seemed that the last time he had gone to a party where he had been promised “new faces,” there had been fifteen people in the room, and he had already spelt with five of the women and owed money to all but two of the men. I laughed with him, but the first snow had just begun to fall and the big Christmas trees glittered yellow and white as far as I could see up Park Avenue and I had a new dress and it would be a long while before I would come to understand the particular moral of the story.</p><p>It would be a long while because, quite simply, I was in love with New York. I do not mean “love” in any colloquial way, I mean that I was in love with the city, the way you love the first person who ever touches you and you never love anyone quite that way again. I remember walking across Sixty-second Street one twilight that first spring, or the second spring, they were all alike for a while. I was late to meet someone but I stopped at Lexington Avenue and bought a peach and stood on the corner eating it and knew that I had come out out of the West and reached the mirage. I could taste the peach and feel the soft air blowing from a subway grating on my legs and I could smell lilac and garbage and expensive perfume and I knew that it would cost something sooner or later—because I did not belong there, did not come from there—but when you are twenty-two or twenty-three, you figure that later you will have a high emotional balance, and be able to pay whatever it costs. I still believed in possibilities then, still had the sense, so peculiar to New York, that something extraordinary would happen any minute, any day, any month. I was making only $65 or $70 then a week then (“Put yourself in Hattie Carnegie’s hands,” I was advised without the slightest trace of irony by an editor of the magazine for which I worked), so little money that some weeks I had to charge food at Bloomingdale’s gourmet shop in order to eat, a fact which went unmentioned in the letters I wrote to California. I never told my father that I needed money because then he would have sent it, and I would never know if I could do it by myself. At that time making a living seemed a game to me, with arbitrary but quite inflexible rules. And except on a certain kind of winter evening—six-thirty in the Seventies, say, already dark and bitter with a wind off the river, when I would be walking very fast toward a bus and would look in the bright windows of brownstones and see cooks working in clean kitchens and and imagine women lighting candles on the floor above and beautiful children being bathed on the floor above that—except on nights like those, I never felt poor; I had the feeling that if I needed money I could always get it. I could write a syndicated column for teenagers under the name “Debbi Lynn” or I could smuggle gold into India or I could become a $100 call girl, and none of would matter.</p><p>Nothing was irrevocable; everything was within reach. Just around every corner lay something curious and interesting, something I had never before seen or done or known about. I could go to a party and meet someone who called himself Mr. Emotional Appeal and ran The Emotional Appeal Institute or Tina Onassis Blandford or a Florida cracker who was then a regular on what the called “the Big C,” the Southampton-El Morocco circuit (“I’m well connected on the Big C, honey,” he would tell me over collard greens on his vast borrowed terrace), or the widow of the celery king of the Harlem market or a piano salesman from Bonne Terre, Missouri, or someone who had already made and list two fortunes in Midland, Texas. I could make promises to myself and to other people and there would be all the time in the world to keep them. I could stay up all night and make mistakes, and none of them would count.</p><p>You see I was in a curious position in New York: it never occurred to me that I was living a real life there. In my imagination I was always there for just another few months, just until Christmas or Easter or the first warm day in May. For that reason I was most comfortable with the company of Southerners. They seemed to be in New York as I was, on some indefinitely extended leave from wherever they belonged, disciplined to consider the future, temporary exiles who always knew when the flights left for New Orleans or Memphis or Richmond or, in my case, California. Someone who lives with a plane schedule in the drawer lives on a slightly different calendar. Christmas, for example, was a difficult season. Other people could take it in stride, going to Stowe or going abroad or going for the day to their mothers’ places in Connecticut; those of us who believed that we lived somewhere else would spend it making and canceling airline reservations, waiting for weatherbound flights as if for the last plane out of Lisbon in 1940, and finally comforting one another, those of us who were left, with oranges and mementos and smoked-oyster stuffings of childhood, gathering close, colonials in a far country.</p><p>Which is precisely what we were. I am not sure that it is possible for anyone brought up in the East to appreciate entirely what New York, the idea of New York, means to those of us who came out of the West and the South. To an Eastern child, particularly a child who has always has an uncle on Wall Street and who has spent several hundred Saturdays first at F.A.O. Schwarz and being fitted for shoes at Best’s and then waiting under the Biltmore clock and dancing to Lester Lanin, New York is just a city, albeit the city, a plausible place for people to live, But to those of us who came from places where no one had heard of Lester Lanin and Grand Central Station was a Saturday radio program, where Wall Street and Fifth Avenue and Madison Avenue were not places at all but abstractions (“Money,” and “High Fashion,” and “The Hucksters”), New York was no mere city. It was instead an infinitely romantic notion, the mysterious nexus of all love and money and power, the shining and perishable dream itself. To think of “living” there was to reduce the miraculous to the mundane; one does not “live” at Xanadu.</p><p>In fact it was difficult in the extreme for me to understand those young women for whom New York was not simply an ephemeral Estoril but a real place, girls who bought toasters and installed new cabinets in their apartments and committed themselves to some reasonable furniture. I never bought any furniture in New York. For a year or so I lived in other people’s apartments; after that I lived in the Nineties in an apartment furnished entirely with things taken from storage by a friend whose wife had moved away. And when I left the apartment in the Nineties (that was when I was leaving everything, when it was all breaking up) I left everything in it, even my winter clothes and the map of Sacramento County I had hung on the bedroom wall to remind me who I was, and I moved into a monastic four-room floor-through on Seventy-fifth Street. “Monastic” is perhaps misleading here, implying some chic severity; until after I was married and my husband moved some furniture in, there was nothing at all in those four rooms except a cheap double mattress and box springs, ordered by telephone the day I decided to move, and two French garden chairs lent me by a friend who imported them. (It strikes me now that the people I knew in New York all had curious and self-defeating sidelines. They imported garden chairs which did not sell very well at Hammacher Schlemmer or they tried to market hair staighteners in Harlem or they ghosted exposés of Murder Incorporated for Sunday supplements. I think that perhaps none of us was very serious, engagé only about our most private lives.)</p><p>All I ever did to that apartment was hang fifty yards of yellow theatrical silk across the bedroom windows, because I had some idea that the gold light would make me feel better, but I did not bother to weight the curtains correctly and all that summer the long panels of transparent golden silk would blow out  the windows and get tangled and drenched in afternoon thunderstorms. That was the year, my twenty-eight, when I was discovering that not all of the promises would be kept, that some things are in fact irrevocable and that it had counted after all, every evasion and ever procrastination, every word, all of it.</p><hr><p>That is what it was all about, wasn’t it? Promises? Now when New York comes back to me it comes in hallucinatory flashes, so clinically detailed that I sometimes wish that memory would effect the distortion with which it is commonly credited. For a lot of the time I was in New York I used a perfume called Fleurs de Rocaille, and then L’Air du Temps, and now the slightest trace of either can short-circuit my connections for the rest of the day. Nor can I smell Henri Bendel jasmine soap without falling back into the past, or the particular mixture of spices used for boiling crabs. There were barrels of crab boil in a Czech place in the Eighties where I once shopped. Smells, of course, are notorious memory stimuli, but there are other things which affect me the same way. Blue-and-white striped sheets. Vermouth cassis. Some faded nightgowns which were new in 1959 or 1960, and some chiffon scarves I bought about the same time.</p><p>I suppose that a lot of us who have been very young in New York have the same scenes in our home screens. I remember sitting in a lot of apartments with a slight headache about five o’clock in the morning. I had a friend who could not sleep, and he knew a few other people who had the same trouble, and we would watch the sky lighten and have a last drink with no ice and then go home in the early morning, when the streets were clean and wet (had it rained in the night? we never knew) and the few cruising taxis still had their headlights on and the only color was the red and green of traffic signals. The White Rose bars opened very early in the morning; I recall waiting in one of them to watch an astronaut go into space, waiting so long that at the moment it actually happened I had my eyes not on the television screen but on a cockroach on the tile floor. I liked the bleak branches above Washington Square at dawn, and the monochromatic flatness of Second Avenue, the fire escapes and the grilled storefronts peculiar and empty in their perspective.</p><p>It is relatively hard to fight at six-thirty or seven in the morning, without any sleep, which was perhaps one reason why we stayed up all night, and it seemed to me a pleasant time of day. The windows were shuttered in that apartment in the Nineties and I could sleep for a few hours and then go to work. I could work the on two or three hours’ sleep and a container of coffee from Chock Full O’ Nuts. I liked going to work, liked the soothing and satisfactory rhythm of getting out a magazine, liked the orderly progression of four-color closings and two-color closings and black-and-white closings and then The Product, no abstraction but something which looked effortlessly glossy and could be picked up on a newsstand and weighed in the hand. I liked all the minutiae of proofs and layouts, liked working late on the nights the magazines went to press, sitting and reading Variety and waiting for the copy desk to call. From my office, I could look across town to the weather signal on the Mutual of New York Building and the lights that alternately spelled TIME and LIFE above Rockeffeler Plaza; that pleased me obscurely, and so did walking uptown in the mauve eight o’clocks of early summer evenings and looking at things, Lowestoft tureens in Fifty-seventh Street windows, people in evening clothes trying to get taxis, the trees just coming into full leaf, the lambent air, all the sweet promises of money and summer.</p><p>Some years passed, but I still did not lose that sense of wonder about New York. I began to cherish the loneliness of it, the sense that at any given time no one need know where I was or what I was doing. I liked walking, from the East River over to the Hudson and back on brisk days, down around the Village on warm days. A friend would leave me the key to her apartment in the West Village when she was out of town, and sometimes I would just move down there, because by that time the telephone was beginning to bother me (the canker, you see, was already in the rose) and not many people had that number. I remember one day when someone who did have the West Village number came to pick me up for lunch there, and we both had hangovers, and I cut my finger opening him a beer and burst into tears, and we walked to a Spanish restaurant and drank bloody Marys and gazpacho until we felt better. I was not then guilt-ridden about spending afternoons that way, because I still had all the afternoons in the world.</p><p>And even that late in the game I still liked going to parties, all parties, bad parties, Saturday-afternoon parties given by recently married couples who lived in Stuyvesant Town, West Side parties given by unpublished or failed writers who served cheap red wine and talked about going to Guatalajara, Village parties where all the guests worked for advertising agencies and voted for Reform Democrats, press parties at Sardi’s, the worst kind of parties. You will have perceived by now that I was not one to profit by the experience of others, that it was a very long time indeed before I stopped believing in new faces and began to understand the lesson in that story, which was that it is distinctly possible to stay too long at the Fair.</p><hr><p>I could not tell you when I began to understand that. All I know is that it was very bad when I was twenty-eight. Everything that was said to me I seemed to have heard before, and I could no longer listen. I could no longer sit in little bars near Grand Central and listen to someone complaining of his wife’s inability to cope with the help while he missed another train to Connecticut. I no longer had any interest in hearing about the advances other people had received from their publishers, about plays which were having second-act trouble in Philadelphia, or about people I would like very much if only I would come out and meet them. I had already met them, always. There were certain parts of the city which I had to avoid. I could not bear upper Madison Avenue on weekday mornings (this was a particularly inconvenient aversion, since I then lived just fifty or sixty feet east of Madison), because I would see women walking Yorkshire terriers and shopping at Gristede’s, and some Veblenesque gorge would rise in my throat. I could not go to Times Square in the afternoon, or to the New York Public Library for any reason whatsoever. One day I could not go into a Schrafft’s; the next it would be the Bonwit Teller.</p><p>I hurt the people I cared about, and insulted those I did not. I cut myself off from the one person who was closer to me than any other. I cried until I was not even aware when I was crying and when I was not, I cried in elevators and in taxis and in Chinese laundries, and when I went to the doctor, he said only that I seemed to be depressed, and that I should see a “specialist.” He wrote down a psychiatrist’s name and address for me, but I did not go.</p><p>Instead I got married, which as it turned out was a very good thing to do but badly timed, since I still could not walk on upper Madison Avenue in the mornings and still could not talk to people and still cried in Chinese laundries. I had never before understood what “despair” meant, and I am not sure that I understand now, but I understood that year. Of course I could not work. I could not even get dinner with any degree of certainty, and I would sit in the apartment on Seventy-fifth Street paralyzed until my husband would call from his office and say gently that I did not have to get dinner, that I could meet him at Michael’s Pub or at Toots Shor’s or at Sardi’s East. And then one morning in April (we had been married in January) he called and told me that he wanted to get out of New York for a while, that he would take a six-month leave of absence, that we would go somewhere.</p><p>It was three years ago he told me that, and we have lived in Los Angeles since. Many of the people we knew in New York think this a curious aberration, and in fact tell us so. There is no possible, no adequate answer to that, and so we give certain stock answers, the answers everyone gives. I talk about how difficult it would be for us to “afford” to live in New York right now, about how much “space” we need, All I mean is that I was very young in New York, and that at some point the golden rhythm was broken, and I am not that young anymore. The last time I was in New York was in a cold January, and everyone was ill and tired. Many of the people I used to know there had moved to Dallas or had gone on Antabuse or had bought a farm in New Hampshire. We stayed ten days, and then we took an afternoon flight back to Los Angeles, and on the way home from the airport that night I could see the moon on the Pacific and smell jasmine all around and we both knew that there was no longer any point in keeping the apartment we still kept in New York. There were years when I called Los Angeles “the Coast,” but they seem a long time ago.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;  “All I mean is that I was very young in New York, and that at some point the golden rhythm was broken, and I am not that young anymore.
      
    
    </summary>
    
      <category term="PersonalEssay" scheme="http://yoursite.com/categories/PersonalEssay/"/>
    
    
      <category term="JoanDidion" scheme="http://yoursite.com/tags/JoanDidion/"/>
    
  </entry>
  
</feed>
